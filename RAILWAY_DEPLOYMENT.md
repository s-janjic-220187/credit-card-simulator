# üöÄ Railway Deployment Guide for Credit Card Simulator

This guide will help you deploy the Credit Card Billing Simulator to Railway.app with PostgreSQL database.

## üìã Prerequisites

- [Railway.app account](https://railway.app/) (free tier available)
- Git repository access
- Basic understanding of environment variables

## üèóÔ∏è Architecture Overview

The application consists of:

- **Frontend**: React + TypeScript + Vite (Nginx served)
- **Backend**: Node.js + Express + TypeScript + Prisma
- **Database**: PostgreSQL
- **File Structure**: Monorepo with separate frontend/backend folders

## üöÄ Deployment Steps

### Step 1: Prepare Your Repository

1. **Ensure all files are committed and pushed to your Git repository**
2. **Verify the following files exist** (they've been created for you):
   ```
   ‚îú‚îÄ‚îÄ backend/
   ‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
   ‚îÇ   ‚îú‚îÄ‚îÄ railway.json
   ‚îÇ   ‚îî‚îÄ‚îÄ start.sh
   ‚îú‚îÄ‚îÄ frontend/
   ‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
   ‚îÇ   ‚îú‚îÄ‚îÄ nginx.conf
   ‚îÇ   ‚îî‚îÄ‚îÄ railway.json
   ‚îú‚îÄ‚îÄ .env.example
   ‚îú‚îÄ‚îÄ .railwayignore
   ‚îî‚îÄ‚îÄ railway.yml
   ```

### Step 2: Create Railway Project

1. **Sign up/Login to Railway.app**

   - Go to [railway.app](https://railway.app/)
   - Sign up with GitHub (recommended)

2. **Create a New Project**
   - Click "New Project"
   - Select "Deploy from GitHub repo"
   - Connect your GitHub account if needed
   - Select your `credit-card-simulator` repository

### Step 3: Set Up PostgreSQL Database

1. **Add PostgreSQL Service**

   - In your Railway project dashboard
   - Click "New" ‚Üí "Database" ‚Üí "Add PostgreSQL"
   - Railway will automatically create a PostgreSQL instance

2. **Note Database Connection**
   - Railway will auto-generate `DATABASE_URL`
   - This will be automatically available to your backend service

### Step 4: Deploy Backend Service

1. **Add Backend Service**

   - Click "New" ‚Üí "GitHub Repo"
   - Select your repository
   - Set **Root Directory**: `backend`
   - Railway will detect the Dockerfile automatically

2. **Configure Environment Variables**

   - Go to your backend service
   - Click "Variables" tab
   - Add the following variables:

   ```bash
   # Required Variables
   NODE_ENV=production
   PORT=3001
   JWT_SECRET=4027c42a481a5bca70b8206101806da462c0066fabfeb550741bb1861355abdb

   # CORS Configuration (set after frontend deployment)
   CORS_ORIGIN=https://frontend-ccs-production.up.railway.app
   ```

   **Generate JWT Secret:**

   ```bash
   # Run this command to generate a secure JWT secret
   node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
   ```

3. **Deploy Backend**
   - Railway will automatically build and deploy
   - Check logs for any errors
   - Note the generated backend URL (e.g., `https://backend-ccs-production.up.railway.app`)

### Step 5: Deploy Frontend Service

1. **Add Frontend Service**

   - Click "New" ‚Üí "GitHub Repo"
   - Select your repository again
   - Set **Root Directory**: `frontend`
   - Railway will detect the Dockerfile automatically

2. **Configure Environment Variables**

   - Go to your frontend service
   - Click "Variables" tab
   - Add the following:

   ```bash
   # Required Variables
   NODE_ENV=production
   PORT=80

   # Backend API URL (use your actual backend URL from Step 4)
   # ‚ö†Ô∏è IMPORTANT: Replace with your actual backend URL (do NOT include /api at the end)
   VITE_API_BASE_URL=https://backend-ccs-production.up.railway.app
   ```

   **üî• CRITICAL**: The `VITE_API_BASE_URL` must be set BEFORE deploying the frontend, as it's needed during build time.

3. **Deploy Frontend**
   - Railway will automatically build and deploy
   - Note the generated frontend URL

### Step 6: Update CORS Configuration

1. **Update Backend CORS**
   - Go to backend service ‚Üí Variables
   - Update `CORS_ORIGIN` with your actual frontend URL:
   ```bash
   CORS_ORIGIN=https://frontend-ccs-production.up.railway.app
   ```
   - Redeploy the backend service

### Step 7: Database Migration

The backend will automatically run database migrations on startup, but you can also run them manually:

1. **Access Backend Terminal** (if needed)

   - Go to backend service ‚Üí "Deploy" tab
   - Click on latest deployment
   - Click "View Logs" to see migration status

2. **Manual Migration** (if needed)
   - In Railway dashboard, go to backend service
   - Click "Deploy" ‚Üí Select latest deployment ‚Üí "View Logs"
   - Migrations should run automatically via the startup script

## üîß Environment Variables Reference

### Backend Variables

```bash
# Core Configuration
NODE_ENV=production
PORT=3001
DATABASE_URL=postgresql://... # Auto-generated by Railway

# Security
JWT_SECRET=your_32_character_minimum_secret_key

# CORS (Frontend URL)
CORS_ORIGIN=https://your-frontend-domain.railway.app
```

### Frontend Variables

```bash
# Core Configuration
NODE_ENV=production
PORT=80

# API Configuration
VITE_API_BASE_URL=https://your-backend-domain.railway.app
```

## üö® Important Security Notes

1. **JWT Secret**: Generate a strong, unique secret key (minimum 32 characters) 4027c42a481a5bca70b8206101806da462c0066fabfeb550741bb1861355abdb
2. **CORS Origin**: Always set to your exact frontend domain
3. **Database**: Railway PostgreSQL is secure by default
4. **Environment Variables**: Never commit secrets to repository

## üîç Troubleshooting

### Common Issues

1. **Backend Not Starting**

   - Check environment variables are set correctly
   - Verify DATABASE_URL is available
   - Check deployment logs for Prisma migration errors

2. **Frontend Can't Connect to Backend**

   - Verify `VITE_API_BASE_URL` is set correctly
   - Check backend CORS configuration
   - Ensure backend service is running

3. **Database Connection Issues**

   - Verify PostgreSQL service is running
   - Check DATABASE_URL format
   - Look for Prisma connection errors in logs

4. **Build Failures**
   - Check Dockerfile syntax
   - Verify all dependencies are in package.json
   - Review build logs for specific errors

### Viewing Logs

- Go to service ‚Üí "Deployments" ‚Üí Click on deployment ‚Üí "View Logs"
- Monitor real-time logs during deployment

### Redeployment

- Push new commits to trigger automatic redeployment
- Or manually redeploy from Railway dashboard

## üéØ Post-Deployment

### Verify Deployment

1. **Test Frontend**

   - Visit your frontend URL
   - Check language selector works (German/English)
   - Navigate through different pages

2. **Test Backend API**

   - Visit `https://your-backend-url.railway.app/health` (if health endpoint exists)
   - Test API endpoints through frontend

3. **Test Database**
   - Create a test user account
   - Create credit card profiles
   - Verify data persistence

## üîß Troubleshooting

### Common Issues

#### 1. Frontend API Calls Failing (405 Method Not Allowed)

**Symptoms**: Frontend shows errors like `POST /api/users/login 405 (Method Not Allowed)`

**Cause**: Frontend is trying to call APIs on its own URL instead of the backend URL

**Solution**:

1. **Check Environment Variables**: Ensure `VITE_API_BASE_URL` is set correctly in your frontend service
2. **Use Correct Backend URL**: Copy the exact URL from your backend service (e.g., `https://backend-ccs-production.up.railway.app`)
3. **Redeploy Frontend**: After setting the environment variable, trigger a new deployment:
   - Go to frontend service ‚Üí "Deployments" tab
   - Click "Deploy Latest Commit" or make a dummy commit to trigger rebuild

**Verification**:

- Open browser developer tools ‚Üí Network tab
- Try logging in and verify API calls go to `https://backend-ccs-production.up.railway.app/api/...`

#### 2. CORS Errors

**Symptoms**: Console shows CORS-related errors

**Solution**:

1. Set `CORS_ORIGIN` in backend service to your frontend URL
2. Redeploy backend service

#### 3. Database Connection Issues

**Symptoms**: Backend logs show database connection errors

**Solution**:

1. Verify `DATABASE_URL` is correctly set in backend service
2. Check PostgreSQL service is running
3. Ensure database migrations ran successfully

#### 4. Prisma Engine Compatibility Issues

**Symptoms**: Backend crashes with errors like:

- `libssl.so.1.1: No such file or directory`
- `Error loading shared library`
- `PrismaClientInitializationError`

**Cause**: Prisma engines incompatible with Alpine Linux (musl libc)

**Solution**:

1. Use Debian-based Docker images (`node:18-slim` instead of `node:18-alpine`)
2. Install OpenSSL in Docker container
3. Specify multiple binary targets in Prisma schema
4. Already fixed in this repository's Dockerfile

#### 5. Build Failures

**Symptoms**: Deployment fails during build process

**Solution**:

1. Check deployment logs for specific error messages
2. Ensure all required files are committed to Git
3. Verify Docker build works locally

### Performance Optimization

1. **Enable Railway Pro** (if needed for better performance)
2. **Monitor Usage** in Railway dashboard
3. **Set up Custom Domain** (optional)

## üîÑ Updates and Maintenance

### Updating the Application

1. Push changes to your GitHub repository
2. Railway will automatically redeploy both services
3. Database migrations will run automatically

### Monitoring

- Use Railway's built-in metrics
- Monitor application logs
- Set up alerts for downtime (Railway Pro feature)

### Backup

- Railway handles PostgreSQL backups automatically
- Consider exporting important data periodically

## üìû Support

If you encounter issues:

1. Check Railway documentation: [docs.railway.app](https://docs.railway.app/)
2. Review application logs in Railway dashboard
3. Check GitHub repository for the latest updates

## üéâ Success!

Once deployed, your Credit Card Simulator will be available at:

- **Frontend**: `https://your-frontend-url.railway.app`
- **Backend API**: `https://your-backend-url.railway.app`

The application includes:

- ‚úÖ German/English localization
- ‚úÖ Credit card management
- ‚úÖ Billing cycle simulation
- ‚úÖ Interactive calculators
- ‚úÖ Educational content
- ‚úÖ Responsive design

Your users can now access the full-featured credit card billing simulator with professional German localization!
